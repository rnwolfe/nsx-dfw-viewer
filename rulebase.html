<html ng-app="fetch">
<head>
    <title>NSX Policy Playground</title>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-animate.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-sanitize.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.2.0.js"></script>
    <script src="script.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"></head>

<body>
  <div class="row">
    <div class="container">
      <h1 align="center">NSX Distributed Firewall Rules</h1>
      <div ng-controller="controller">
        <p><input type="text" ng-model="sectionFilter" placeholder="Section Search.." class="form-control" /></p>
        <div ng-repeat="section in rulebase.layer3Sections.layer3Sections | filter:sectionFilter">
            <div class="panel panel-default">
              <div class="panel-heading" ng-model="collapsed" ng-click="collapsed=!collapsed" style="cursor: pointer;"><h4>Section: {{ section.name }}</h4></div>           
                <div class="panel-body" ng-show="collapsed">
                    <table class="table table-hover table-striped table-responsive small">
                        <thead>
                            <tr>
                                <th>Rule Name</th>
                                <th>Action</th>
                                <th>Direction</th>
                                <th>Sources</th>
                                <th>Destinations</th>
                                <th>Services</th>
                                <th>Applied to</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="rule in section.rules" ng-style="if_disabled(rule.disabled)">
                                <td>{{ rule.name }}</td>
                                <td>{{ rule.action }}</td>
                                <td>{{ rule.direction }}</td>
                                <td>
                                    <div ng-repeat="item in rule.sources.sourceList">
                                        <span ng-show="item.name" popover-trigger="'mouseenter'" popover-placement="right" popover-title="{{ item.name }}" uib-popover-template="'popovertpl.html'" popover-append-to-body="true">{{ item.name || 'any' }}</span>
                                    </div>
                                </td>
                                <td>
                                    <div ng-repeat="item in rule.destinations.destinationList">
                                        <span ng-show="item.name" popover-trigger="'mouseenter'" popover-placement="right" popover-title="{{ item.name }}" uib-popover-template="'popovertpl.html'" popover-append-to-body="true">{{ item.name || 'any' }}</span>
                                    </div>
                                </td>
                                <td>
                                    <div ng-repeat="service in rule.services.serviceList">{{ service.name || 'any' }}</div>
                                </td>
                                <td>
                                    <div ng-repeat="appliedTo in rule.appliedToList.appliedToList">{{ appliedTo.name }}</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

      </div>
    </div>
  </div>
</body>

<script type="text/ng-template" id="popovertpl.html">
    <div ng-init="getContents(item.value, item.type);">
        <div ng-show="isEmpty(contents)" style="text-align: center;"><img src="img/loading.gif"  width="88" height="58" /></div>
        <div ng-repeat="item in contents track by $index">{{ item }}</div>
    </div>
</script>
</html>